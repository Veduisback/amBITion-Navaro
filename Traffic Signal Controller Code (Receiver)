import paho.mqtt.client as mqtt

BROKER = "broker.hivemq.com"
TOPIC = "traffic/signal/request"

def on_message(client, userdata, msg):
    data = eval(msg.payload.decode())  # ‚ö†Ô∏è in production use JSON safely
    signal_id = data["signal_id"]
    action = data["action"]

    if action == "REQUEST_GREEN":
        print(f"üö¶ Signal {signal_id}: Switching to GREEN for Ambulance {data['ambulance_id']}")
        # Here: send command to traffic light controller hardware
        # e.g., GPIO output or API call to PLC/traffic system

client = mqtt.Client()
client.connect(BROKER, 1883, 60)
client.subscribe(TOPIC)
client.on_message = on_message

print("Traffic signal controller is running...")
client.loop_forever()
